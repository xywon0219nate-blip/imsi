<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet" />
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #1e293b; color: white; padding: 40px; max-width: 900px; margin: 0 auto; }
        
        /* 탭 스타일 */
        .tabs { display: flex; gap: 15px; margin-bottom: 25px; border-bottom: 1px solid #475569; padding-bottom: 10px; }
        .tab-btn {
            background: none; border: none; color: #94a3b8; font-size: 1.1rem; font-weight: bold; cursor: pointer; padding: 10px;
        }
        .tab-btn.active { color: #38bdf8; border-bottom: 3px solid #38bdf8; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* 리스트 스타일 */
        .list-item {
            background: #334155; padding: 20px; border-radius: 12px; margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center; gap: 20px;
        }
        .info-container { flex: 1; }
        .title { font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; }
        .sub-text { font-size: 0.9rem; color: #94a3b8; margin-bottom: 5px; }
        .q-text { background: #1e293b; padding: 10px; border-radius: 6px; font-size: 0.95rem; color: #e2e8f0; margin-top: 5px; }
        .a-text { color: #38bdf8; margin-top: 5px; font-weight: bold; }

        /* 이미지 스타일 */
        .proof-img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid #475569; }

        /* 버튼 */
        button { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-approve { background: #22c55e; color: white; }
        .btn-reply { background: #38bdf8; color: white; }
        .btn-done { background: #64748b; color: #cbd5e1; cursor: default; }

        /* 모달 */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-box { background: #1e293b; width: 90%; max-width: 500px; padding: 30px; border-radius: 15px; border: 1px solid #475569; }
        .modal-textarea { width: 100%; height: 100px; margin: 15px 0; background: #334155; color: white; border: 1px solid #475569; padding: 10px; resize: none; }
        .modal-btns { display: flex; justify-content: flex-end; gap: 10px; }
        
        .empty-msg { text-align: center; color: #94a3b8; margin-top: 30px; }
        .back-link { display: block; margin-top: 30px; color: #38bdf8; text-align: center; text-decoration: none; }
    </style>
</head>
<body>
    <h1 style="border-bottom: 1px solid #475569; padding-bottom: 20px;">관리자 페이지</h1>
    
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('cert')">인증 승인</button>
        <button class="tab-btn" onclick="switchTab('inquiry')">1:1 문의 관리</button>
    </div>

    <div id="tab-cert" class="tab-content active">
        <div id="cert-list"></div>
    </div>

    <div id="tab-inquiry" class="tab-content">
        <div id="inquiry-list"></div>
    </div>

    <a href="Notice.html" class="back-link">고객센터로 이동</a>

    <div class="modal-overlay" id="replyModal">
        <div class="modal-box">
            <h3>답변 작성하기</h3>
            <p id="modal-q-text" style="font-size:0.9rem; color:#94a3b8; margin-top:10px;"></p>
            <textarea id="replyText" class="modal-textarea" placeholder="답변을 입력하세요"></textarea>
            <div class="modal-btns">
                <button onclick="closeModal()" style="background:#ef4444; color:white;">취소</button>
                <button onclick="submitReply()" style="background:#38bdf8; color:white;">등록</button>
            </div>
        </div>
    </div>

    <script>
        let currentReplyId = null;

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            if (tabName === 'cert') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('tab-cert').classList.add('active');
                loadCertifications();
            } else {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('tab-inquiry').classList.add('active');
                loadInquiries();
            }
        }

        // --- 1. 인증 승인 로직 ---
        function loadCertifications() {
            const list = document.getElementById('cert-list');
            const reviewList = JSON.parse(localStorage.getItem('reviewList') || '[]');
            const pending = reviewList.filter(i => i.status === 'pending');

            if (pending.length === 0) { list.innerHTML = "<div class='empty-msg'>대기 중인 인증 요청이 없습니다.</div>"; return; }

            let html = '';
            pending.forEach(item => {
                html += `
                    <div class="list-item">
                        <img src="${item.image}" class="proof-img" onerror="this.src='https://via.placeholder.com/80?text=No+Img'">
                        <div class="info-container">
                            <div class="title">${item.name}</div>
                            <div class="sub-text">${item.date} | ${item.point}g</div>
                        </div>
                        <button class="btn-approve" onclick="approveCert(${item.id})">승인</button>
                    </div>`;
            });
            list.innerHTML = html;
        }

        function approveCert(id) {
            let list = JSON.parse(localStorage.getItem('reviewList') || '[]');
            list = list.map(item => item.id === id ? { ...item, status: 'approved' } : item);
            localStorage.setItem('reviewList', JSON.stringify(list));
            alert("승인되었습니다.");
            loadCertifications();
        }

        // --- 2. 문의 답변 로직 ---
        function loadInquiries() {
            const list = document.getElementById('inquiry-list');
            const inquiries = JSON.parse(localStorage.getItem('inquiryList') || '[]');
            
            // 답변 대기중인 것을 위로 정렬
            inquiries.sort((a, b) => (a.status === 'wait' ? -1 : 1));

            if (inquiries.length === 0) { list.innerHTML = "<div class='empty-msg'>등록된 문의가 없습니다.</div>"; return; }

            let html = '';
            inquiries.forEach(item => {
                const isWait = item.status === 'wait';
                const btn = isWait 
                    ? `<button class="btn-reply" onclick="openModal(${item.id})">답변하기</button>` 
                    : `<button class="btn-done" disabled>완료됨</button>`;

                html += `
                    <div class="list-item">
                        <div class="info-container">
                            <div class="sub-text">${isWait ? '대기중' : '답변완료'} | ${item.date}</div>
                            <div class="title">${item.title}</div>
                            <div class="q-text">Q. ${item.content}</div>
                            ${!isWait ? `<div class="a-text">A. ${item.answer}</div>` : ''}
                        </div>
                        ${btn}
                    </div>`;
            });
            list.innerHTML = html;
        }

        function openModal(id) {
            currentReplyId = id;
            const inquiries = JSON.parse(localStorage.getItem('inquiryList') || '[]');
            const item = inquiries.find(i => i.id === id);
            document.getElementById('modal-q-text').innerText = "질문: " + item.content;
            document.getElementById('replyText').value = '';
            document.getElementById('replyModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('replyModal').style.display = 'none'; }

        function submitReply() {
            const answer = document.getElementById('replyText').value;
            if (!answer.trim()) return alert("내용을 입력하세요.");

            let inquiries = JSON.parse(localStorage.getItem('inquiryList') || '[]');
            inquiries = inquiries.map(item => item.id === currentReplyId ? { ...item, status: 'done', answer: answer } : item);
            localStorage.setItem('inquiryList', JSON.stringify(inquiries));
            
            alert("답변이 등록되었습니다.");
            closeModal();
            loadInquiries();
        }

        window.onload = loadCertifications;
    </script>
</body>
</html>
