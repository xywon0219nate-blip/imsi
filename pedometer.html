<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§Œë³´ê¸° - FindMyRide</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet" />
    <style>
        :root { --main-blue: #457b9d; --dark-blue: #1d3557; --bg-color: #fafafa; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        body { 
            background-color: var(--bg-color); color: var(--dark-blue); 
            display: flex; flex-direction: column; min-height: 100vh; 
            text-align: center;
        }

        header {
            background: #fff; padding: 18px 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            display: flex; justify-content: center; align-items: center; position: relative;
        }
        .back-btn { position: absolute; left: 20px; font-size: 24px; cursor: pointer; }
        .logo { font-weight: 800; font-size: 1.2rem; }

        .container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; }

        /* ì›í˜• ê²Œì´ì§€ (CSSë¡œ êµ¬í˜„) */
        .circle-container {
            position: relative; width: 250px; height: 250px; margin-bottom: 30px;
        }
        .circle-bg {
            width: 100%; height: 100%; border-radius: 50%;
            border: 15px solid #e2e8f0;
        }
        .step-count-box {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        .step-number { font-size: 60px; font-weight: 800; color: var(--main-blue); line-height: 1; }
        .step-label { font-size: 16px; color: #64748b; margin-top: 5px; }

        .info-text { font-size: 1.1rem; color: #475569; margin-bottom: 40px; line-height: 1.5; }

        button {
            padding: 18px 40px; border-radius: 50px; font-size: 18px; font-weight: bold;
            border: none; cursor: pointer; transition: all 0.2s; width: 100%; max-width: 300px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* ì‹œì‘ ë²„íŠ¼ */
        .start-btn { background: var(--main-blue); color: white; }
        .start-btn:hover { background: #35607a; transform: scale(1.05); }

        /* ì™„ë£Œ ë²„íŠ¼ (ì²˜ìŒì—” ìˆ¨ê¹€) */
        .finish-btn { 
            background: #22c55e; color: white; display: none; 
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        /* ê°œë°œììš© í…ŒìŠ¤íŠ¸ ë²„íŠ¼ (ë°œí‘œ ë•Œ ì„¼ì„œ ì•ˆ ë¨¹ìœ¼ë©´ ë¹„ìƒìš©) */
        .dev-btn {
            margin-top: 20px; background: none; border: none; 
            color: #ccc; font-size: 12px; box-shadow: none; text-decoration: underline;
        }
    </style>
</head>
<body>

    <header>
        <div class="back-btn" onclick="history.back()">â†</div>
        <div class="logo">ë§Œë³´ê¸° ëª¨ë“œ</div>
    </header>

    <div class="container">
        <div class="circle-container">
            <div class="circle-bg"></div>
            <div class="step-count-box">
                <div class="step-number" id="step-display">0</div>
                <div class="step-label">ê±¸ìŒ</div>
            </div>
        </div>

        <p class="info-text" id="status-msg">
            'ì‹œì‘í•˜ê¸°'ë¥¼ ëˆ„ë¥´ê³ <br>
            ìŠ¤ë§ˆíŠ¸í°ì„ ë“¤ê³  ì œìë¦¬ê±¸ìŒì„ í•´ë³´ì„¸ìš”!
        </p>

        <button class="start-btn" id="start-btn" onclick="requestPermission()">ì‹œì‘í•˜ê¸°</button>
        <button class="finish-btn" id="finish-btn" onclick="finishWalking()">10g ë°›ê¸° (ì™„ë£Œ)</button>

        <button class="dev-btn" onclick="incrementStep()">[Dev] ê°•ì œ ê±¸ìŒ ì¶”ê°€</button>
    </div>

    <script>
        let stepCount = 0;
        const goalSteps = 30; // ëª©í‘œ ê±¸ìŒ ìˆ˜ (ì‹œì—°ìš©ìœ¼ë¡œ 30ê±¸ìŒ ì„¤ì •)
        let isRunning = false;
        let lastX = 0, lastY = 0, lastZ = 0;
        let lastTime = 0;
        const threshold = 12; // ê°ë„ ì„¤ì • (ìˆ«ìê°€ í´ìˆ˜ë¡ ì„¸ê²Œ í”ë“¤ì–´ì•¼ í•¨)

        function requestPermission() {
            // iOS 13+ ê¸°ê¸° ëŒ€ì‘ (ê¶Œí•œ ìš”ì²­ í•„ìš”)
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(response => {
                        if (response == 'granted') {
                            startPedometer();
                        } else {
                            alert("ì„¼ì„œ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        }
                    })
                    .catch(console.error);
            } else {
                // ì•ˆë“œë¡œì´ë“œ ë˜ëŠ” êµ¬í˜• iOS (ë°”ë¡œ ì‹œì‘)
                startPedometer();
            }
        }

        function startPedometer() {
            isRunning = true;
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('status-msg').innerText = "ì—´ì‹¬íˆ ê±·ëŠ” ì¤‘...ğŸƒ\ní™”ë©´ì„ ë„ì§€ ë§ˆì„¸ìš”!";
            
            // ì„¼ì„œ ì´ë²¤íŠ¸ ì—°ê²°
            window.addEventListener('devicemotion', handleMotion);
        }

        function handleMotion(event) {
            if (!isRunning) return;

            const acc = event.accelerationIncludingGravity;
            if (!acc) return; // ì„¼ì„œ ì—†ëŠ” ê²½ìš°

            const currentTime = new Date().getTime();
            
            // 100ms(0.1ì´ˆ) ë§ˆë‹¤ ì²´í¬ (ë„ˆë¬´ ë¹ ë¥¸ ì§„ë™ ë¬´ì‹œ)
            if ((currentTime - lastTime) > 100) {
                const diffTime = currentTime - lastTime;
                lastTime = currentTime;

                // ì›€ì§ì„ì˜ í¬ê¸° ê³„ì‚°
                const speed = Math.abs(acc.x + acc.y + acc.z - lastX - lastY - lastZ) / diffTime * 10000;

                // ì„ê³„ê°’ ë„˜ìœ¼ë©´ ê±¸ìŒìœ¼ë¡œ ì¸ì •
                if (speed > threshold) {
                    incrementStep();
                }

                lastX = acc.x;
                lastY = acc.y;
                lastZ = acc.z;
            }
        }

        function incrementStep() {
            stepCount++;
            document.getElementById('step-display').innerText = stepCount;

            // ëª©í‘œ ë‹¬ì„± ì‹œ
            if (stepCount >= goalSteps) {
                document.getElementById('status-msg').innerHTML = "ğŸ‰ ëª©í‘œ ë‹¬ì„±!<br>í¬ì¸íŠ¸ë¥¼ ë°›ì•„ì£¼ì„¸ìš”.";
                document.getElementById('status-msg').style.color = "#22c55e";
                document.getElementById('status-msg').style.fontWeight = "bold";
                
                // ì™„ë£Œ ë²„íŠ¼ í™œì„±í™”
                const finishBtn = document.getElementById('finish-btn');
                finishBtn.style.display = 'block';
                
                // ì„¼ì„œ ë„ê¸° (ë°°í„°ë¦¬ ì ˆì•½)
                window.removeEventListener('devicemotion', handleMotion);
                isRunning = false;
            }
        }

        function finishWalking() {
            // ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ì„œ í¬ì¸íŠ¸ ì§€ê¸‰ ë¡œì§ ì‹¤í–‰
            // 'walkingSuccess'ë¼ëŠ” í‚¤ë¥¼ ì €ì¥í•´ì„œ Index.htmlì´ ì•Œê²Œ í•¨
            localStorage.setItem('walkingSuccess', 'true');
            localStorage.setItem('walkingPoints', '10'); // 10g ì§€ê¸‰
            
            alert("ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! íƒ„ì†Œë¥¼ ì¤„ì´ì…¨êµ°ìš”.");
            location.href = 'Index.html';
        }
    </script>
</body>
</html>